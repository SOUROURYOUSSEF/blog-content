
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Setup Docker storage to use LVM thin pool Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.0">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="0020-openshift-example.html" />
    
    
    <link rel="prev" href="0018-openshift-cluster-up.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">2014</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="0001-javascript-loaders.html">
            
                <a href="0001-javascript-loaders.html">
            
                    
                    JavaScript Loaders
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="0002-trigger-phonegap-build-from-github.html">
            
                <a href="0002-trigger-phonegap-build-from-github.html">
            
                    
                    Trigger PhoneGap builds from GitHub
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">2016</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="0003-hello-internet.html">
            
                <a href="0003-hello-internet.html">
            
                    
                    Hello, Internet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="0004-setup-self-hosted-cloud9.html">
            
                <a href="0004-setup-self-hosted-cloud9.html">
            
                    
                    Setting up a powerful self-hosted IDE in the cloud
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="0005-custom-ceph-atomic-deployment.html">
            
                <a href="0005-custom-ceph-atomic-deployment.html">
            
                    
                    Deployment of Ceph using custom Atomic images
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="0006-nonroot-container.html">
            
                <a href="0006-nonroot-container.html">
            
                    
                    non-root user inside a Docker container
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="0007-highlighting-code-text.html">
            
                <a href="0007-highlighting-code-text.html">
            
                    
                    Highlighting of Code and Text
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="0008-multitier-setup-openstack.html">
            
                <a href="0008-multitier-setup-openstack.html">
            
                    
                    Building a multi-tier application using OpenStack (PackStack)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="0012-ha-storage-using-gluster.html">
            
                <a href="0012-ha-storage-using-gluster.html">
            
                    
                    Highly Available storage using GlusterFS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="0013-document-generation.html">
            
                <a href="0013-document-generation.html">
            
                    
                    Document generation using Markdown and Pandoc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="0015-mentor-recommended-books.html">
            
                <a href="0015-mentor-recommended-books.html">
            
                    
                    Mentors and recommended books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="0016-object-design.html">
            
                <a href="0016-object-design.html">
            
                    
                    Object Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11" data-path="0017-kubernetes-ansible.html">
            
                <a href="0017-kubernetes-ansible.html">
            
                    
                    Deploying Kubernetes using Ansible
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12" data-path="0018-openshift-cluster-up.html">
            
                <a href="0018-openshift-cluster-up.html">
            
                    
                    Deploying OpenShift
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.13" data-path="0019-setup-docker-storage.html">
            
                <a href="0019-setup-docker-storage.html">
            
                    
                    Setup Docker storage to use LVM thin pool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14" data-path="0020-openshift-example.html">
            
                <a href="0020-openshift-example.html">
            
                    
                    Run an example application on OpenShift
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15" data-path="0021-give-to-content-creators.html">
            
                <a href="0021-give-to-content-creators.html">
            
                    
                    Giving to your favourite content creators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16" data-path="0022-dear-recruiter.html">
            
                <a href="0022-dear-recruiter.html">
            
                    
                    Dear recruiter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.17" data-path="0023-ansible-to-replace-scripts-packages.md">
            
                <span>
            
                    
                    Replace scripts with Ansible: package installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.18" data-path="0024-personal-kanban-using-gitlab.md">
            
                <span>
            
                    
                    Task management and Personal Kanban: how I use GitLab Issues
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Setup Docker storage to use LVM thin pool</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>If you install Docker on a new Fedora or CentOS system, it is very likely that
you use devicemapper. Especially in the case of Fedora cloud images, no special
configuration is done to the image. While Atomic images come pre-configured with
a dedicated pool. Using devicemapper with loopback can lead to unpredictable
behaviour, and while OverlayFS is a nice replacement, you will not be able to
use SELinux at the moment. In this short article I will show how to setup a pool
for storing the Docker images.</p><h2 id="preparation">Preparation</h2><p>For this article I will be using a Fedora 24 installation on an OpenStack cloud
provider<a href="http://citycloud.com" target="_blank">*</a>. It is a standard Cloud image, which means the
root is configured as &apos;ext4&apos;. I will be attaching a storage volume to the
instance. Just like using Virtual Manager, the disk will be identified as
<code>/dev/vdb</code>.</p><p>First you need to stop the Docker process and remove the existing location. This
means you will loose the images, but if they are important, you can either
export or push them somewhere else.</p><pre><code>$ systemctl stop docker
$ rm -rf /var/lib/docker</code></pre>
<p>After this we will create a basic LVM setup which will use the whole storage
volume.</p><pre><code>$ pvcreate /dev/vdb
$ vgcreate docker_vol /dev/vdb</code></pre>
<p>We know have a <code>volumegroup</code> named <code>docker_vol</code>.</p><h2 id="setup-docker-storage">Setup Docker storage</h2><p>Fedora comes with a tool that makes it easy to setup the storage for Docker,
called <code>docker-storage-setup</code>. The configuration is done with a file, and in
our case it needs to contain the identification of the volume group to use:</p><pre><code>$ vi /etc/sysconfig/docker-storage-setup </code></pre>
<pre><code>VG=&quot;docker_vol&quot;</code></pre>
<p>Now you can run:</p><pre><code>$ docker-storage-setup</code></pre>
<p>This will create the filesystem and configures Docker to use the storage pool.
After this successfully finishes, it has configured the pool to use the xfs
filesystem.</p><h2 id="verify">Verify</h2><p>To verify these changes, we will start Docker and run a basic image.</p><pre><code>$ systemctl start docker
$ docker info</code></pre>
<pre><code>Storage Driver: devicemapper
 Pool Name: docker_vol-docker--pool
 Pool Blocksize: 524.3 kB
 Base Device Size: 10.74 GB
 Backing Filesystem: xfs
 Data file: 
 Metadata file: 
 Data Space Used: 37.75 MB
 Data Space Total: 21.45 GB
 Data Space Available: 21.41 GB
 Metadata Space Used: 53.25 kB
 Metadata Space Total: 54.53 MB
 Metadata Space Available: 54.47 MB
 Udev Sync Supported: true
 Deferred Removal Enabled: true
 Deferred Deletion Enabled: true
 Deferred Deleted Device Count: 0
 Library Version: 1.02.122 (2016-04-09)</code></pre>
<pre><code>$ docker pull busybox
$ docker run -it --rm busybox
/ # </code></pre>
<h2 id="conclusion">Conclusion</h2><p>Configuration of storage has been really simplified and shouldn&apos;t be a reason
not to do this. However, still to many people are not aware of the issues with
devicemapper and loopback. Having to assign additional software to use Docker
can also be a reason why people do not consider doing this, but even OverlayFS
is not perfect. Using overlay with SELinux will be possible in the future, and
hopefully soon these steps will also not be needed. In any case, the steps
involved are simple and if you use Docker on Fedora, needed!</p><h2 id="more-information">More information</h2><ul><li><a href="http://www.projectatomic.io/blog/2015/06/notes-on-fedora-centos-and-docker-storage-drivers/" target="_blank">Friends Don&apos;t Let Friends Run Docker on Loopback in Production</a>
</li>
<li><a href="http://www.projectatomic.io/docs/docker-storage-recommendation/" target="_blank">Setting up storage</a> for Project Atomic
</li></ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="0018-openshift-cluster-up.html" class="navigation navigation-prev " aria-label="Previous page: Deploying OpenShift">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="0020-openshift-example.html" class="navigation navigation-next " aria-label="Next page: Run an example application on OpenShift">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"Title":"Setup Docker storage to use LVM thin pool","Date":"2016-09-28T00:00:00.000Z","Category":"containers","Tags":"docker, containers, atomic, storage","title":"Setup Docker storage to use LVM thin pool","level":"3.13","depth":1,"next":{"title":"Run an example application on OpenShift","level":"3.14","depth":1,"path":"0020-openshift-example.md","ref":"0020-openshift-example.md","articles":[]},"previous":{"title":"Deploying OpenShift","level":"3.12","depth":1,"path":"0018-openshift-cluster-up.md","ref":"0018-openshift-cluster-up.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"0019-setup-docker-storage.md","mtime":"2016-11-08T07:03:09.000Z","type":"markdown"},"gitbook":{"version":"3.2.0","time":"2016-11-08T07:03:13.428Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

