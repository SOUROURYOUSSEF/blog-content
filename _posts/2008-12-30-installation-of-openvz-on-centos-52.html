---
layout: post
title: "Installation of OpenVZ on CentOS 5.2"
date: 2008-12-30
comments: false
categories:
 - linux
 - centos
 - openvz
---

<div class='post'>
OS virtualization allows you to better scale if you need a large amount of similar software installations and you do not want to deploy more than one physical (or even virtual) machine. It creates isolated containers in which your environment run. In a way it is comparable to a jailed environment, but it provides better isolation, security and management. Hardware virtualization, for products as VMware, XEN and KVM, has a different approach in which you run a completely emulated distribution (often paravirualized) on top of your host system. OS and Hardware virtualization can complement each other.<br /><br />The installation of <a href="http://www.openvz.org/">OpenVZ</a> containers on <a href="http://www.centos.org/">CentOS</a> (or RHEL5) is very simple. The following steps were performed on a default installation of CentOS 5.2. In my case I use a virtual machine in a VMware environment.<br /><br /><b>The OpenVZ installation</b><br /><code><br />$ setup<br /></code><br />First you need to disable SELinux and the firewall.<br /><code><br />$ cd /etc/yum.repos.d<br />$ wget http://download.openvz.org/openvz.repo<br />$ rpm --import http://download.openvz.org/RPM-GPG-Key-OpenVZ<br />$ yum -y install ovzkernel<br />$ vi /etc/sysctl.conf<br /></code><br />In this file change the following lines:<br /><code><br />net.ipv4.ip_forward = 1<br />kernel.sysrq = 1<br />net.ipv4.conf.default.proxy_arp = 0<br /></code><br />In this same file add the following lines:<br /><code><br />net.ipv4.conf.default.send_redirects = 1<br />net.ipv4.conf.all.send_redirects = 0</code><br /><br />Install the OpenVZ service and have it start at boot:<br /><code><br />$ yum install vzctl vzquota<br />$ chkconfig --add vz<br />$ reboot<br /></code><br /><br /><b>Container configuration</b><br />After this, you need to create or download an OS template. For keeping this post easy, I use a precreated template:<br /><code><br />$ cd /vz/template/cache<br />$ wget http://mirror.proserve.nl/openvz/contrib/template/precreated/centos-5-i386-default.tar.gz<br /></code><br />Now you can create your first OS container from this template. The information we need is an IP address, hostname and nameservers.<br /><code><br />$ vzctl create 101 --ostemplate centos-5-i386-default --conf vps.basic --ipadd 10.73.11.150 --hostname c1.survion.net<br />$ vzctl set 101 --name c1 --nameserver "10.73.11.1 10.73.11.2 10.73.11.3" --diskspace 10G:10G --save<br />$ vzctl set 101 --userpasswd root:password --save<br /></code><br />Each container instance is represented by an CTID. In the previous steps we used id 101 the identify the container. The configured information can now be found in the file /etc/vz/conf/101.conf. Be sure to use your own secret password for the last command.<br /><br />You can now start this container and list processes<br /><code><br />$ vzctl start 101<br />$ vzctl exec 101 ps ax<br /></code><br />You can also issue an enter command:<br /><code><br />$ vzctl enter 101<br /></code><br />You would then authenticate as root inside the container. On the console you can perform commands as if you would on a normal machine.<br /><br /><br />That's it! You now have a CentOS container running on top of your CentOS installation.<br /><br /><br /><b>Links and additional information</b><br />Information on how to create a template can be found on <a href="http://wiki.openvz.org/OS_template_cache_preparation">http://wiki.openvz.org/OS_template_cache_preparation</a><br /><br />OS Templates can be found at:<br /><ul><li><a href="http://forum.openvz.org/index.php?t=msg&amp;goto=15905">http://forum.openvz.org/index.php?t=msg&amp;goto=15905</a></li><li><a href="http://mirror.proserve.nl/openvz/contrib/template/precreated/">http://mirror.proserve.nl/openvz/contrib/template/precreated/</a></li></ul>If you download the minimal template you can not enter the container. This is because the container does not have a console configured. You could still issue commands using the 'vzctl exec' command and be able to configure the console, but YMMV.<br /><br />You can read more detailed information about the installation on the following websites:<br /><ul><li><a href="http://wiki.openvz.org/Quick_installation">http://wiki.openvz.org/Quick_installation</a></li><li><a href="http://wiki.centos.org/HowTos/Virtualization/OpenVZ"> http://wiki.centos.org/HowTos/Virtualization/OpenVZ</a></li></ul><br /><br />Edit: An interesting experiment performed by Scott Dowdle can be found on <a href="http://www.montanalinux.org/scott">his blog</a> called '<a href="http://www.montanalinux.org/openvz-experiment.html">How many containers?</a>'.</div>
